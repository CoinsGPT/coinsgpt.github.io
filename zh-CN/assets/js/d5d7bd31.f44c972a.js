"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["23696"],{46565:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>d,default:()=>u,contentTitle:()=>o,assets:()=>c,toc:()=>i,metadata:()=>s});var s=JSON.parse('{"id":"tools/cloudflare-tunnel","title":"Cloudflare Tunnel","description":"Great \u2014 if you already have a domain name on Cloudflare, the best option is to use Cloudflare Tunnel (formerly Argo Tunnel). It lets you:","source":"@site/docs/tools/cloudflare-tunnel.md","sourceDirName":"tools","slug":"/tools/cloudflare-tunnel","permalink":"/zh-CN/docs/next/tools/cloudflare-tunnel","draft":false,"unlisted":false,"editUrl":"https://crowdin.com/project/docusaurus-v2/zh-CN","tags":[],"version":"current","lastUpdatedBy":"thebestornothing","lastUpdatedAt":1754041686000,"frontMatter":{},"sidebar":"docs","previous":{"title":"Tools","permalink":"/zh-CN/docs/next/category/tools"}}'),r=l(85893),t=l(80980);let d={},o="Cloudflare Tunnel",c={},i=[{value:"Step 1: Install <code>cloudflared</code>",id:"step-1-install-cloudflared",level:2},{value:"Step 2: Authenticate Cloudflare",id:"step-2-authenticate-cloudflare",level:2},{value:"Step 3: Create the Tunnel",id:"step-3-create-the-tunnel",level:2},{value:"Step 4: Create a Config File",id:"step-4-create-a-config-file",level:2},{value:"\uFE0F Step 5: Set up DNS Route",id:"\uFE0F-step-5-set-up-dns-route",level:2},{value:"Step 6: Run the Tunnel",id:"step-6-run-the-tunnel",level:2},{value:"Summary",id:"summary",level:2},{value:"Bug Fixing",id:"bug-fixing",level:2}];function a(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cloudflare-tunnel",children:"Cloudflare Tunnel"})}),"\n",(0,r.jsxs)(n.p,{children:["Great \u2014 if you ",(0,r.jsx)(n.strong,{children:"already have a domain name on Cloudflare"}),", the ",(0,r.jsx)(n.strong,{children:"best option"})," is to use ",(0,r.jsx)(n.strong,{children:"Cloudflare Tunnel (formerly Argo Tunnel)"}),". It lets you:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Expose your local server to the internet ",(0,r.jsx)(n.strong,{children:"without a static IP"})]}),"\n",(0,r.jsxs)(n.li,{children:["Use your own ",(0,r.jsx)(n.strong,{children:"custom domain"})]}),"\n",(0,r.jsxs)(n.li,{children:["Avoid ",(0,r.jsx)(n.strong,{children:"port forwarding"})]}),"\n",(0,r.jsxs)(n.li,{children:["Get ",(0,r.jsx)(n.strong,{children:"free HTTPS certificates"})," automatically"]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"step-1-install-cloudflared",children:["Step 1: Install ",(0,r.jsx)(n.code,{children:"cloudflared"})]}),"\n",(0,r.jsx)(n.p,{children:"On your server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo dpkg -i cloudflared-linux-amd64.deb\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-2-authenticate-cloudflare",children:"Step 2: Authenticate Cloudflare"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cloudflared tunnel login\n"})}),"\n",(0,r.jsx)(n.p,{children:"This will open a browser to log in and pick your Cloudflare domain."}),"\n",(0,r.jsx)(n.h2,{id:"step-3-create-the-tunnel",children:"Step 3: Create the Tunnel"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cloudflared tunnel create openwebUI\n"})}),"\n",(0,r.jsx)(n.p,{children:"This creates a named tunnel and gives you a tunnel ID and credentials file."}),"\n",(0,r.jsx)(n.h2,{id:"step-4-create-a-config-file",children:"Step 4: Create a Config File"}),"\n",(0,r.jsxs)(n.p,{children:["Default location: ",(0,r.jsx)(n.code,{children:"~/.cloudflared/config.yml"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"tunnel: openwebUI\ncredentials-file: ~/.cloudflared/51049f68-692e-4e7c-a22c-5c7e4f202391.json\n\ningress:\n  - hostname: openwebui.coinsgpt.io\n    service: http://localhost:3000\n  - service: http_status:404\n"})}),"\n",(0,r.jsx)(n.p,{children:"Replace:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"yoursub.yourdomain.com"})," \u2192 a subdomain you want to expose"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"localhost:3000"})," \u2192 your actual local server address"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\uFE0F-step-5-set-up-dns-route",children:"\uFE0F Step 5: Set up DNS Route"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cloudflared tunnel route dns openwebUI openwebui.coinsgpt.io\n"})}),"\n",(0,r.jsx)(n.p,{children:"This automatically adds a CNAME record in your Cloudflare DNS pointing to the tunnel."}),"\n",(0,r.jsx)(n.h2,{id:"step-6-run-the-tunnel",children:"Step 6: Run the Tunnel"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cloudflared tunnel run openwebUI\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now your app is live at:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"https://openwebui.coinsgpt.io\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Cloudflare Tunnel"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Static IP needed?"}),(0,r.jsx)(n.td,{children:"\u274C No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Uses your domain?"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"HTTPS?"}),(0,r.jsx)(n.td,{children:"\u2705 Automatic"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Port Forwarding?"}),(0,r.jsx)(n.td,{children:"\u274C Not required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Free?"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (generous limits)"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"bug-fixing",children:"Bug Fixing"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"cloudflared"})," cannot resolve Cloudflare's edge SRV records"]})," due to a ",(0,r.jsx)(n.strong,{children:"DNS issue"})," on your server. The resolver ",(0,r.jsx)(n.code,{children:"127.0.0.53"})," (systemd-resolved) is failing to look up ",(0,r.jsx)(n.code,{children:"_v2-origintunneld._tcp.argotunnel.com"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Test DNS resolution"})}),"\n",(0,r.jsx)(n.p,{children:"Run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dig srv _v2-origintunneld._tcp.argotunnel.com @1.1.1.1\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If this works, your local DNS (",(0,r.jsx)(n.code,{children:"127.0.0.53"}),") is broken or blocked."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Use Cloudflare's DNS (1.1.1.1 & 1.0.0.1)"})}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"/etc/resolv.conf"}),", add following DNS server:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"nameserver 1.1.1.1\nnameserver 8.8.8.1\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tip:"})," On Ubuntu 22.04, ",(0,r.jsx)(n.code,{children:"systemd-resolved"})," may overwrite ",(0,r.jsx)(n.code,{children:"/etc/resolv.conf"}),". To permanently set DNS:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo systemctl disable systemd-resolved\nsudo systemctl stop systemd-resolved\nsudo rm /etc/resolv.conf\necho -e "nameserver 1.1.1.1\\nnameserver 8.8.8.8" | sudo tee /etc/resolv.conf\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Retry the tunnel"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cloudflared tunnel run openwebUI\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["4. Add ",(0,r.jsx)(n.code,{children:"config.yml"})," (Important!)"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"WRN No ingress rules were defined...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You must create ",(0,r.jsx)(n.code,{children:"~/.cloudflared/config.yml"}),":"]})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},80980:function(e,n,l){l.d(n,{Z:()=>o,a:()=>d});var s=l(67294);let r={},t=s.createContext(r);function d(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);