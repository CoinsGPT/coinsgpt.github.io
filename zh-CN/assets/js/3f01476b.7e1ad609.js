"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["84630"],{42934:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>i,default:()=>h,contentTitle:()=>a,assets:()=>c,toc:()=>l,metadata:()=>o});var o=JSON.parse('{"id":"bitcoin/kafka","title":"Managing Kafka Topics and Consumer Groups","description":"In this guide, we\u2019ll simulate a use case for managing Bitcoin-related streaming data using Apache Kafka. We\'ll cover how to create topics, manage consumers, observe consumption status, and configure retention policies.","source":"@site/docs/bitcoin/kafka.md","sourceDirName":"bitcoin","slug":"/bitcoin/kafka","permalink":"/zh-CN/docs/next/bitcoin/kafka","draft":false,"unlisted":false,"editUrl":"https://crowdin.com/project/docusaurus-v2/zh-CN","tags":[],"version":"current","lastUpdatedBy":"thebestornothing","lastUpdatedAt":1747126481000,"frontMatter":{},"sidebar":"bitcoin","previous":{"title":"Convert raw data with ETL","permalink":"/zh-CN/docs/next/bitcoin/bitcoin-etl"},"next":{"title":"Using the Kafka table engine","permalink":"/zh-CN/docs/next/bitcoin/kafka-table-engine"}}'),t=s(85893),r=s(80980);let i={},a="Managing Kafka Topics and Consumer Groups",c={},l=[{value:"\uD83D\uDE80 Scenario: Stream Bitcoin Blocks and Transactions",id:"-scenario-stream-bitcoin-blocks-and-transactions",level:2},{value:"\u2705 1. Create Kafka Topics",id:"-1-create-kafka-topics",level:2},{value:"\uD83D\uDD0D Verify that the topics were created:",id:"-verify-that-the-topics-were-created",level:3},{value:"\u2705 2. Produce and Consume Messages",id:"-2-produce-and-consume-messages",level:2},{value:"\uD83D\uDD04 Produce messages into a topic:",id:"-produce-messages-into-a-topic",level:3},{value:"\uD83D\uDCE5 Consume messages from the beginning:",id:"-consume-messages-from-the-beginning",level:3},{value:"\u2705 3. Create and Use Consumer Groups",id:"-3-create-and-use-consumer-groups",level:2},{value:"\u2705 4. Monitor Consumer Groups",id:"-4-monitor-consumer-groups",level:2},{value:"\uD83D\uDCCB List all consumer groups:",id:"-list-all-consumer-groups",level:3},{value:"\uD83D\uDCCA Describe group state (offsets, lag, assignments):",id:"-describe-group-state-offsets-lag-assignments",level:3},{value:"\uD83E\uDDFE Sample Output:",id:"-sample-output",level:4},{value:"\u2705 5. Configure Log Retention (to prevent disk overflow)",id:"-5-configure-log-retention-to-prevent-disk-overflow",level:2},{value:"\uD83E\uDDE0 Explanation:",id:"-explanation",level:3},{value:"\u2705 6. Describe a Kafka Topic (to check configs)",id:"-6-describe-a-kafka-topic-to-check-configs",level:2},{value:"\uD83D\uDCCC Summary",id:"-summary",level:2}];function d(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"managing-kafka-topics-and-consumer-groups",children:"Managing Kafka Topics and Consumer Groups"})}),"\n",(0,t.jsxs)(n.p,{children:["In this guide, we\u2019ll simulate a use case for managing Bitcoin-related streaming data using ",(0,t.jsx)(n.strong,{children:"Apache Kafka"}),". We'll cover how to create topics, manage consumers, observe consumption status, and configure retention policies."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-scenario-stream-bitcoin-blocks-and-transactions",children:"\uD83D\uDE80 Scenario: Stream Bitcoin Blocks and Transactions"}),"\n",(0,t.jsx)(n.p,{children:"You\u2019re building a Kafka-based data pipeline for Bitcoin. You\u2019ll:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create Kafka topics: ",(0,t.jsx)(n.code,{children:"blocks"})," and ",(0,t.jsx)(n.code,{children:"transactions"})]}),"\n",(0,t.jsx)(n.li,{children:"Create consumer groups automatically"}),"\n",(0,t.jsx)(n.li,{children:"Produce and consume messages"}),"\n",(0,t.jsx)(n.li,{children:"Monitor consumer lags"}),"\n",(0,t.jsx)(n.li,{children:"Set log retention policies to prevent disk overflow"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-1-create-kafka-topics",children:"\u2705 1. Create Kafka Topics"}),"\n",(0,t.jsxs)(n.p,{children:["Topics are the core abstraction for message streams. You create them using ",(0,t.jsx)(n.code,{children:"kafka-topics.sh"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create the 'blocks' topic with 3 partitions and replication factor 1\nkafka-topics.sh \\\n  --create \\\n  --topic blocks \\\n  --bootstrap-server localhost:9092 \\\n  --partitions 3 \\\n  --replication-factor 1\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create the 'transactions' topic with 3 partitions and replication factor 1\nkafka-topics.sh \\\n  --create \\\n  --topic transactions \\\n  --bootstrap-server localhost:9092 \\\n  --partitions 3 \\\n  --replication-factor 1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-verify-that-the-topics-were-created",children:"\uD83D\uDD0D Verify that the topics were created:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# List all existing Kafka topics\nkafka-topics.sh \\\n  --list \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-2-produce-and-consume-messages",children:"\u2705 2. Produce and Consume Messages"}),"\n",(0,t.jsx)(n.h3,{id:"-produce-messages-into-a-topic",children:"\uD83D\uDD04 Produce messages into a topic:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Start a producer to the 'transactions' topic\nkafka-console-producer.sh \\\n  --topic transactions \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,t.jsx)(n.p,{children:"Type messages in the terminal after this command runs."}),"\n",(0,t.jsx)(n.h3,{id:"-consume-messages-from-the-beginning",children:"\uD83D\uDCE5 Consume messages from the beginning:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Start a consumer to read all messages from the beginning of the topic\nkafka-console-consumer.sh \\\n  --topic transactions \\\n  --from-beginning \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-3-create-and-use-consumer-groups",children:"\u2705 3. Create and Use Consumer Groups"}),"\n",(0,t.jsxs)(n.p,{children:["Consumer groups are created ",(0,t.jsx)(n.strong,{children:"implicitly"})," when a consumer subscribes to a topic with a unique ",(0,t.jsx)(n.code,{children:"--group"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Consume from 'blocks' with consumer group 'bitcoin-group'\nkafka-console-consumer.sh \\\n  --bootstrap-server localhost:9092 \\\n  --topic blocks \\\n  --group bitcoin-group\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Consume from 'transactions' with the same group\nkafka-console-consumer.sh \\\n  --bootstrap-server localhost:9092 \\\n  --topic transactions \\\n  --group bitcoin-group\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now the group ",(0,t.jsx)(n.code,{children:"bitcoin-group"})," is created and tracks offsets for each consumer."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-4-monitor-consumer-groups",children:"\u2705 4. Monitor Consumer Groups"}),"\n",(0,t.jsx)(n.h3,{id:"-list-all-consumer-groups",children:"\uD83D\uDCCB List all consumer groups:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kafka-consumer-groups.sh \\\n  --bootstrap-server localhost:9092 \\\n  --list\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-describe-group-state-offsets-lag-assignments",children:"\uD83D\uDCCA Describe group state (offsets, lag, assignments):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kafka-consumer-groups.sh \\\n  --describe \\\n  --group bitcoin-group \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,t.jsx)(n.h4,{id:"-sample-output",children:"\uD83E\uDDFE Sample Output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"TOPIC       PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID     HOST             CLIENT-ID\nblocks      0          120             150             30   consumer-1-xyz  /192.168.0.2     consumer-1\ntransactions 1         110             140             30   consumer-1-xyz  /192.168.0.2     consumer-1\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-5-configure-log-retention-to-prevent-disk-overflow",children:"\u2705 5. Configure Log Retention (to prevent disk overflow)"}),"\n",(0,t.jsx)(n.p,{children:"You can configure how long Kafka retains messages or how much disk space it uses per topic."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Set retention to 1 day and max 1GB per partition for 'blocks'\nkafka-configs.sh \\\n  --bootstrap-server localhost:9092 \\\n  --entity-type topics \\\n  --entity-name blocks \\\n  --alter \\\n  --add-config retention.ms=86400000,retention.bytes=1073741824,cleanup.policy=delete\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Same for 'transactions'\nkafka-configs.sh \\\n  --bootstrap-server localhost:9092 \\\n  --entity-type topics \\\n  --entity-name transactions \\\n  --alter \\\n  --add-config retention.ms=86400000,retention.bytes=1073741824,cleanup.policy=delete\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-explanation",children:"\uD83E\uDDE0 Explanation:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retention.ms=86400000"}),": retain messages for 1 day."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retention.bytes=1073741824"}),": max 1 GB per partition."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cleanup.policy=delete"}),": delete old segments (default behavior)."]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Kafka will delete log segments when ",(0,t.jsx)(n.strong,{children:"either"})," of the conditions is met."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-6-describe-a-kafka-topic-to-check-configs",children:"\u2705 6. Describe a Kafka Topic (to check configs)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View details of the 'transactions' topic\nkafka-topics.sh \\\n  --describe \\\n  --topic transactions \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-summary",children:"\uD83D\uDCCC Summary"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Task"}),(0,t.jsx)(n.th,{children:"Command"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Create topic"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-topics.sh --create"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"List topics"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-topics.sh --list"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Describe topic"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-topics.sh --describe"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Produce message"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-console-producer.sh"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Consume message"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-console-consumer.sh"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Use consumer group"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"--group my-group"})," on consumer"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"List consumer groups"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-consumer-groups.sh --list"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Describe consumer group"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-consumer-groups.sh --describe --group my-group"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Configure topic retention"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-configs.sh --alter --add-config"})})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["Let me know if you\u2019d like a ",(0,t.jsx)(n.strong,{children:"visual diagram"})," or an ",(0,t.jsx)(n.strong,{children:"automated script"})," to initialize everything!"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},80980:function(e,n,s){s.d(n,{Z:()=>a,a:()=>i});var o=s(67294);let t={},r=o.createContext(t);function i(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);