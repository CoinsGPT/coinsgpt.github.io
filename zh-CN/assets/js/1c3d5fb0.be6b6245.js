"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["25996"],{57234:function(n,e,t){t.d(e,{Z:()=>s});let s=t.p+"assets/images/bitcoin_data_pipeline-083bc34cccd93411924337896b88770f.png"},12625:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>r,default:()=>a,contentTitle:()=>c,assets:()=>l,toc:()=>h,metadata:()=>s});var s=JSON.parse('{"id":"bitcoin/bitcoin-data-consistency","title":"05 Bitcoin Data Consistency","description":"Data Consistency","source":"@site/docs/bitcoin/bitcoin-data-consistency.md","sourceDirName":"bitcoin","slug":"/bitcoin/bitcoin-data-consistency","permalink":"/zh-CN/docs/next/bitcoin/bitcoin-data-consistency","draft":false,"unlisted":false,"editUrl":"https://crowdin.com/project/docusaurus-v2/zh-CN","tags":[],"version":"current","lastUpdatedBy":"thebestornothing","lastUpdatedAt":1752511136000,"frontMatter":{},"sidebar":"bitcoin","previous":{"title":"04 ClickHouse Schema","permalink":"/zh-CN/docs/next/bitcoin/clickhouse-schema"},"next":{"title":"04 ClickHouse Data Sync","permalink":"/zh-CN/docs/next/bitcoin/clickhouse-data-sync"}}'),i=t(85893),d=t(80980);let r={},c="05 Bitcoin Data Consistency",l={},h=[{value:"Data Consistency",id:"data-consistency",level:2},{value:"Transaction Table",id:"transaction-table",level:2},{value:"Block Table",id:"block-table",level:2}];function o(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"05-bitcoin-data-consistency",children:"05 Bitcoin Data Consistency"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:t(57234).Z+"",width:"1536",height:"1024"})}),"\n",(0,i.jsx)(e.h2,{id:"data-consistency",children:"Data Consistency"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Concept:"})," Ingest raw blockchain data into ",(0,i.jsx)(e.strong,{children:"wide, append-only staging tables"})," (\u201Cfat\u201D tables). Once the data is complete and deduplicated, ",(0,i.jsx)(e.strong,{children:"transform and load"})," it into ",(0,i.jsx)(e.strong,{children:"narrow, query-optimized tables"})," (\u201Ctight\u201D tables).\n",(0,i.jsx)(e.strong,{children:"Benefits:"}),"\n\u2022 Simple, resilient ETL\u2014raw arrays are stored exactly once.\n\u2022 Historical re-processing is unnecessary; transformations are repeatable.\n\u2022 Final tables have smaller rows, sorted keys, and domain-specific indexes that accelerate analytics."]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"transaction-table",children:"Transaction Table"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE transactions\n(\n  hash String,\n  size UInt64,\n  virtual_size UInt64,\n  version UInt64,\n  lock_time UInt64,\n  block_hash String,\n  block_number UInt64,\n  block_timestamp DateTime,\n  block_timestamp_month Date,\n  is_coinbase BOOL,\n  input_count UInt64,\n  output_count UInt64,\n  input_value Float64,\n  output_value Float64,\n  fee Float64,\n  inputs Array(Tuple(index UInt64, spent_transaction_hash String, spent_output_index UInt64, script_asm String, script_hex String, sequence UInt64, required_signatures UInt64, type String, addresses Array(String), value Float64)),\n  outputs Array(Tuple(index UInt64, script_asm String, script_hex String, required_signatures UInt64, type String, addresses Array(String), value Float64)),\n  revision UInt64\n)\nENGINE = ReplacingMergeTree(revision)\nPRIMARY KEY (hash)\nPARTITION BY toYYYYMM(block_timestamp)\nORDER BY (hash);\n"})}),"\n",(0,i.jsx)(e.p,{children:"Original copy from transactions_fat, Raw import. Field spending_transaction_hash equals spent_transaction_hash, spending_output_index equals spent_output_index. Only add revision filed."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"INSERT INTO transactions\nSELECT\n  hash,\n  size,\n  virtual_size,\n  version,\n  lock_time,\n  block_hash,\n  block_number,\n  block_timestamp,\n  block_timestamp_month,\n  is_coinbase,\n  input_count,\n  output_count,\n  input_value,\n  output_value,\n  fee,\n  inputs,\n  outputs,\n  0 AS revision\nFROM transactions_fat\nWHERE toYYYYMM(block_timestamp) >= 200901\n  AND toYYYYMM(block_timestamp) < 200903;\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Column"}),(0,i.jsx)(e.th,{children:"Revision"}),(0,i.jsx)(e.th,{children:"Description"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Transaction hash (primary key)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Size of transaction in bytes"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"virtual_size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Virtual size (for fee calculation)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"version"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Transaction version"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"lock_time"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Lock time (when the transaction becomes valid)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Hash of the block this transaction belongs to"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_number"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Height of the block this transaction belongs to"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_timestamp"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Timestamp of the block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_timestamp_month"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Month partition of the block timestamp"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"is_coinbase"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Whether the transaction is coinbase"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of inputs in the transaction"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of outputs in the transaction"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_value"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Sum of input values"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_value"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Sum of output values"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"fee"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Transaction fee = input_value - output_value"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"inputs"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of input details (index, script, signature info, spent TX, value, etc.)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"outputs"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of output details (index, script, address, value, etc.)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"revision"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Used by ReplacingMergeTree to track changes"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"INSERT INTO transactions\nSELECT\n    t.hash,\n    t.size,\n    t.virtual_size,\n    t.version,\n    t.lock_time,\n    t.block_hash,\n    t.block_number,\n    t.block_timestamp,\n    t.block_timestamp_month,\n    t.is_coinbase,\n    t.input_count,\n    t.output_count,\n    COALESCE(i.total_input_value, 0) AS input_value,\n    t.output_value,\n    COALESCE(i.total_input_value, 0) - t.output_value AS fee,\n    t.inputs,\n    t.outputs,\n    1 AS revision\nFROM transactions AS t\nLEFT JOIN (\n    SELECT\n        transaction_hash,\n        count() AS input_count,\n        sum(value) AS total_input_value\n    FROM inputs\n    GROUP BY transaction_hash\n    WHERE toYYYYMM(t.block_timestamp) = {partition}\n) AS i\nON t.hash = i.transaction_hash\nWHERE toYYYYMM(t.block_timestamp) = {partition};\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Column"}),(0,i.jsx)(e.th,{children:"Revision"}),(0,i.jsx)(e.th,{children:"Description"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Transaction hash (primary key)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Size of transaction in bytes"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"virtual_size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Virtual size (for fee calculation)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"version"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Transaction version"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"lock_time"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Lock time (when the transaction becomes valid)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Hash of the block this transaction belongs to"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_number"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Height of the block this transaction belongs to"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_timestamp"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Timestamp of the block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"block_timestamp_month"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Month partition of the block timestamp"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"is_coinbase"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Whether the transaction is coinbase"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of inputs in the transaction"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of outputs in the transaction"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_value"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Sum of input values"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_value"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Sum of output values"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"fee"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Transaction fee = input_value - output_value"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"inputs"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of input details (index, script, signature info, spent TX, value, etc.)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"outputs"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of output details (index, script, address, value, etc.)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"revision"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Used by ReplacingMergeTree to track changes"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"block-table",children:"Block Table"}),"\n",(0,i.jsx)(e.p,{children:"The revision column in your blocks table is used to distinguish different versions or revisions of the same data row (keyed by hash) in the ReplacingMergeTree. This enables maintain and update rows over time and identify whether a row is an original copy or has been enriched or modified"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE blocks\n(\n  hash String,\n  size UInt64,\n  stripped_size UInt64,\n  weight UInt64,\n  number UInt64,\n  version UInt64,\n  merkle_root String,\n  timestamp DateTime,\n  timestamp_month Date,\n  nonce String,\n  bits String,\n  coinbase_param String,\n  previous_block_hash String,\n  difficulty Float64,\n  transaction_count UInt64,\n  transactions Array(String),\n  total_fees Float64,\n  subsidy Float64,\n  reward Float64,\n  coinbase_transaction String,\n  coinbase_addresses Array(String),\n  input_count UInt64,\n  input_value Float64,\n  output_count UInt64,\n  output_value Float64,\n  revision UInt64\n)\nENGINE = ReplacingMergeTree(revision)\nPRIMARY KEY (hash)\nPARTITION BY toYYYYMM(timestamp)\nORDER BY hash;\n"})}),"\n",(0,i.jsx)(e.p,{children:"Original raw copy from blocks_fat (minimal schema). when copying the original data, default values are added for the extra fields"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"    INSERT INTO blocks\n    SELECT\n      hash,\n      size,\n      stripped_size,\n      weight,\n      number,\n      version,\n      merkle_root,\n      timestamp,\n      timestamp_month,\n      nonce,\n      bits,\n      coinbase_param,\n      previous_block_hash,\n      difficulty,\n      transaction_count,\n      transactions,\n      0.0 AS total_fees,\n      0.0 AS subsidy,\n      0.0 AS reward,\n      '' AS coinbase_transaction,\n      [] AS coinbase_addresses,\n      0 AS input_count,\n      0.0 AS input_value,\n      0 AS output_count,\n      0.0 AS output_value,\n      0 AS revision\n    FROM blocks_fat\n    WHERE toYYYYMM(timestamp) = 200901\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Column"}),(0,i.jsx)(e.th,{children:"Revision"}),(0,i.jsx)(e.th,{children:"Description"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"total_fees"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Sum of all transaction fees in block (input value - output value)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"subsidy"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Block subsidy (depends on height)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"reward"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"subsidy + total_fees"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_transaction"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Coinbase TX ID (first transaction)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_addresses"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Addresses in the coinbase transaction\u2019s outputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_count"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Total number of inputs in all transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_value"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Total value of all inputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_count"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Total number of outputs in all transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_value"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Total value of all outputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block hash (primary key)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block size in bytes"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"stripped_size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block size without witness data"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"weight"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block weight (segwit)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"number"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block height"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"version"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block version"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"merkle_root"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Merkle root of transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"timestamp"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Timestamp of block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"timestamp_month"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Date part (month) of timestamp"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nonce"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Nonce used for PoW"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"bits"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Difficulty bits format"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_param"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Raw coinbase input script param"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"previous_block_hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Hash of previous block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"difficulty"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Difficulty target"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"transaction_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of transactions in block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"transactions"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of TXIDs in the block"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"INSERT INTO blocks\nSELECT\n    b.hash,\n    b.size,\n    b.stripped_size,\n    b.weight,\n    b.number,\n    b.version,\n    b.merkle_root,\n    b.timestamp,\n    b.timestamp_month,\n    b.nonce,\n    b.bits,\n    b.coinbase_param,\n    b.previous_block_hash,\n    b.difficulty,\n    b.transaction_count,\n    b.transactions,\n    COALESCE(t.total_fees, 0) AS total_fees,\n    b.subsidy,\n    b.reward,\n    b.coinbase_transaction,\n    b.coinbase_addresses,\n    COALESCE(t.input_count, 0) AS input_count,\n    COALESCE(t.input_value, 0) AS input_value,\n    COALESCE(t.output_count, 0) AS output_count,\n    COALESCE(t.output_value, 0) AS output_value,\n    1 AS revision\nFROM blocks AS b\nLEFT JOIN (\n    SELECT\n        block_hash,\n        SUM(input_count) AS input_count,\n        SUM(input_value) AS input_value,\n        SUM(output_count) AS output_count,\n        SUM(output_value) AS output_value,\n        SUM(fee) AS total_fees,\n    FROM transactions\n    WHERE toYYYYMM(t.block_timestamp) = {partition}\n    GROUP BY block_hash\n) AS t\nON b.hash = t.block_hash\nWHERE toYYYYMM(b.timestamp) = {partition}; -- Optional: partition filter\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Column"}),(0,i.jsx)(e.th,{children:"Revision"}),(0,i.jsx)(e.th,{children:"Description"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"total_fees"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Sum of all transaction fees in block (input value - output value)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"subsidy"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Block subsidy (depends on height)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"reward"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"subsidy + total_fees"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_transaction"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Coinbase TX ID (first transaction)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_addresses"})}),(0,i.jsx)(e.td,{children:"\u274C"}),(0,i.jsx)(e.td,{children:"Addresses in the coinbase transaction\u2019s outputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_count"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Total number of inputs in all transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"input_value"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Total value of all inputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_count"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Total number of outputs in all transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"output_value"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"Total value of all outputs"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block hash (primary key)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block size in bytes"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"stripped_size"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block size without witness data"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"weight"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block weight (segwit)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"number"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block height"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"version"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Block version"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"merkle_root"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Merkle root of transactions"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"timestamp"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Timestamp of block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"timestamp_month"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Date part (month) of timestamp"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nonce"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Nonce used for PoW"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"bits"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Difficulty bits format"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"coinbase_param"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Raw coinbase input script param"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"previous_block_hash"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Hash of previous block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"difficulty"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Difficulty target"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"transaction_count"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Number of transactions in block"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"transactions"})}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Array of TXIDs in the block"})]})]})]})]})}function a(n={}){let{wrapper:e}={...(0,d.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},80980:function(n,e,t){t.d(e,{Z:()=>c,a:()=>r});var s=t(67294);let i={},d=s.createContext(i);function r(n){let e=s.useContext(d);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(d.Provider,{value:e},n.children)}}}]);