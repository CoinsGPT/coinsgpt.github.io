"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["1853"],{57234:function(n,t,e){e.d(t,{Z:()=>s});let s=e.p+"assets/images/bitcoin_data_pipeline-083bc34cccd93411924337896b88770f.png"},3805:function(n,t,e){e.r(t),e.d(t,{frontMatter:()=>d,default:()=>x,contentTitle:()=>c,assets:()=>h,toc:()=>l,metadata:()=>s});var s=JSON.parse('{"id":"bitcoin/clickhouse-schema","title":"04 ClickHouse Schema","description":"Bitcoin Schema Design","source":"@site/versioned_docs/version-3.7.1/bitcoin/clickhouse-schema.md","sourceDirName":"bitcoin","slug":"/bitcoin/clickhouse-schema","permalink":"/docs/bitcoin/clickhouse-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/coinsgpt/coinsgpt.github.io/edit/main/website/docs/bitcoin/clickhouse-schema.md","tags":[],"version":"3.7.1","frontMatter":{},"sidebar":"bitcoin","previous":{"title":"04 ClickHouse Setup","permalink":"/docs/bitcoin/clickhouse-setup"},"next":{"title":"05 ClickHouse Schema Evolution","permalink":"/docs/bitcoin/clickhouse-schema-evolution"}}'),i=e(85893),r=e(80980);let d={},c="04 ClickHouse Schema",h={},l=[{value:"Bitcoin Schema Design",id:"bitcoin-schema-design",level:2},{value:"JSON type",id:"json-type",level:2},{value:"blocks.json",id:"blocksjson",level:3},{value:"transactions.json",id:"transactionsjson",level:3},{value:"transaction_input",id:"transaction_input",level:3},{value:"transaction_output",id:"transaction_output",level:3}];function a(n){let t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"04-clickhouse-schema",children:"04 ClickHouse Schema"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:e(57234).Z+"",width:"1536",height:"1024"})}),"\n",(0,i.jsx)(t.h2,{id:"bitcoin-schema-design",children:"Bitcoin Schema Design"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE blocks\n(\n  hash String,\n  size UInt64,\n  stripped_size UInt64,\n  weight UInt64,\n  number UInt64,\n  version UInt64,\n  merkle_root String,\n  timestamp DateTime,\n  timestamp_month Date,\n  nonce String,\n  bits String,\n  coinbase_param String,\n  transaction_count UInt64\n)\nENGINE = ReplacingMergeTree()\nPRIMARY KEY (hash)\nPARTITION BY toYYYYMM(timestamp_month)\nORDER BY hash;\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE transactions\n(\n  hash String,\n  size UInt64,\n  virtual_size UInt64,\n  version UInt64,\n  lock_time UInt64,\n  block_hash String,\n  block_number UInt64,\n  block_timestamp DateTime,\n  block_timestamp_month Date,\n  input_count UInt64,\n  output_count UInt64,\n  input_value Float64,\n  output_value Float64,\n  is_coinbase BOOL,\n  fee Float64,\n  inputs Array(Tuple(index UInt64, spent_transaction_hash String, spent_output_index UInt64, script_asm String, script_hex String, sequence UInt64, required_signatures UInt64, type String, addresses Array(String), value Float64)),\n  outputs Array(Tuple(index UInt64, script_asm String, script_hex String, required_signatures UInt64, type String, addresses Array(String), value Float64))\n)\nENGINE = ReplacingMergeTree()\nPRIMARY KEY (block_hash, hash)\nPARTITION BY toYYYYMM(block_timestamp_month)\nORDER BY (block_hash, hash);\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE VIEW outputs AS\nSELECT\n    hash AS transaction_hash,\n    block_hash,\n    block_number,\n    block_timestamp,\n    output.1 AS index,\n    output.2 AS script_asm,\n    output.3 AS script_hex,\n    output.4 AS required_signatures,\n    output.5 AS type,\n    output.6 AS addresses,\n    output.7 AS value\nFROM transactions\nARRAY JOIN outputs AS output;\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE VIEW inputs AS\nSELECT\n    hash AS transaction_hash,\n    block_hash,\n    block_number,\n    block_timestamp,\n    input.1 AS index,\n    input.2 AS spent_transaction_hash,\n    input.3 AS spent_output_index,\n    input.4 AS script_asm,\n    input.5 AS script_hex,\n    input.6 AS sequence,\n    input.7 AS required_signatures,\n    input.8 AS type,\n    input.9 AS addresses,\n    input.10 AS value\nFROM transactions\nARRAY JOIN inputs AS input;\n"})}),"\n",(0,i.jsx)(t.h2,{id:"json-type",children:"JSON type"}),"\n",(0,i.jsx)(t.h3,{id:"blocksjson",children:"blocks.json"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Field"}),(0,i.jsx)(t.th,{children:"Type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"hash"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"size"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"stripped_size"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"weight"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"number"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"version"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"merkle_root"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"timestamp"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"nonce"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"bits"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"coinbase_param"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"transaction_count"}),(0,i.jsx)(t.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"transactionsjson",children:"transactions.json"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Field"}),(0,i.jsx)(t.th,{children:"Type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"hash"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"size"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"virtual_size"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"version"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"lock_time"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"block_number"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"block_hash"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"block_timestamp"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"is_coinbase"}),(0,i.jsx)(t.td,{children:"boolean"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"index"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"inputs"}),(0,i.jsx)(t.td,{children:"[]transaction_input"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"outputs"}),(0,i.jsx)(t.td,{children:"[]transaction_output"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"input_count"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"output_count"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"input_value"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"output_value"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"fee"}),(0,i.jsx)(t.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"transaction_input",children:"transaction_input"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Field"}),(0,i.jsx)(t.th,{children:"Type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"index"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"spent_transaction_hash"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"spent_output_index"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"script_asm"}),(0,i.jsx)(t.td,{children:"string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"script_hex"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"sequence"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"required_signatures"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"type"}),(0,i.jsx)(t.td,{children:"string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"addresses"}),(0,i.jsx)(t.td,{children:"[]string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"value"}),(0,i.jsx)(t.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"transaction_output",children:"transaction_output"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Field"}),(0,i.jsx)(t.th,{children:"Type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"index"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"script_asm"}),(0,i.jsx)(t.td,{children:"string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"script_hex"}),(0,i.jsx)(t.td,{children:"hex_string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"required_signatures"}),(0,i.jsx)(t.td,{children:"bigint"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"type"}),(0,i.jsx)(t.td,{children:"string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"addresses"}),(0,i.jsx)(t.td,{children:"[]string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"value"}),(0,i.jsx)(t.td,{children:"bigint"})]})]})]})]})}function x(n={}){let{wrapper:t}={...(0,r.a)(),...n.components};return t?(0,i.jsx)(t,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},80980:function(n,t,e){e.d(t,{Z:()=>c,a:()=>d});var s=e(67294);let i={},r=s.createContext(i);function d(n){let t=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(t):{...t,...n}},[t,n])}function c(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),s.createElement(r.Provider,{value:t},n.children)}}}]);