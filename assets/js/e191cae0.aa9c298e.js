"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["49362"],{57234:function(n,e,t){t.d(e,{Z:()=>s});let s=t.p+"assets/images/bitcoin_data_pipeline-083bc34cccd93411924337896b88770f.png"},84206:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>c,default:()=>a,contentTitle:()=>d,assets:()=>l,toc:()=>o,metadata:()=>s});var s=JSON.parse('{"id":"bitcoin/clickhouse-setup","title":"04 ClickHouse Setup","description":"When you run ClickHouse manually with clickhouse server without explicitly specifying --config-file, it auto-generates a temporary config in the preprocessed_configs/ directory, and that config:","source":"@site/versioned_docs/version-3.7.1/bitcoin/clickhouse-setup.md","sourceDirName":"bitcoin","slug":"/bitcoin/clickhouse-setup","permalink":"/docs/bitcoin/clickhouse-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/coinsgpt/coinsgpt.github.io/edit/main/website/docs/bitcoin/clickhouse-setup.md","tags":[],"version":"3.7.1","frontMatter":{},"sidebar":"bitcoin","previous":{"title":"03 Create Kafka Topics and Consumer Groups","permalink":"/docs/bitcoin/kafka-setup"},"next":{"title":"05 Kafka Table Engine","permalink":"/docs/bitcoin/kafka-table-engine"}}'),i=t(85893),r=t(80980);let c={},d="04 ClickHouse Setup",l={},o=[{value:"Create a custom temporary config file",id:"create-a-custom-temporary-config-file",level:2},{value:"Verify Configuration Works",id:"verify-configuration-works",level:2},{value:"Bitcoin Schema Design",id:"bitcoin-schema-design",level:2},{value:"JSON type",id:"json-type",level:2},{value:"blocks.json",id:"blocksjson",level:3},{value:"transactions.json",id:"transactionsjson",level:3},{value:"transaction_input",id:"transaction_input",level:3},{value:"transaction_output",id:"transaction_output",level:3}];function h(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"04-clickhouse-setup",children:"04 ClickHouse Setup"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:t(57234).Z+"",width:"1536",height:"1024"})}),"\n",(0,i.jsxs)(e.p,{children:["When you run ClickHouse manually with ",(0,i.jsx)(e.code,{children:"clickhouse server"})," ",(0,i.jsxs)(e.strong,{children:["without explicitly specifying ",(0,i.jsx)(e.code,{children:"--config-file"})]}),", it ",(0,i.jsx)(e.strong,{children:"auto-generates a temporary config"})," in the ",(0,i.jsx)(e.code,{children:"preprocessed_configs/"})," directory, and that config:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Ignores"})," your ",(0,i.jsx)(e.code,{children:"/etc/clickhouse-server/config.xml"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Overrides"})," any user/password definitions"]}),"\n",(0,i.jsx)(e.li,{children:"Makes it appear as if config changes don\u2019t work"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["To ",(0,i.jsx)(e.strong,{children:"run ClickHouse manually"})," and ",(0,i.jsxs)(e.strong,{children:["set a password for the ",(0,i.jsx)(e.code,{children:"default"})," user"]})," from the beginning \u2014 without relying on the default autogenerated config."]}),"\n",(0,i.jsx)(e.h2,{id:"create-a-custom-temporary-config-file",children:"Create a custom temporary config file"}),"\n",(0,i.jsx)(e.p,{children:"If you're running ClickHouse from a custom directory or testing, do this:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["Create a config file ",(0,i.jsx)(e.code,{children:"my-config.xml"})," in the current directory:"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<clickhouse>\n    <listen_host>::</listen_host>\n    <logger>\n        <level>trace</level>\n        <console>true</console>\n    </logger>\n\n    <http_port>8123</http_port>\n    <tcp_port>9000</tcp_port>\n    <mysql_port>9004</mysql_port>\n\n    <path>./</path>\n\n    <mlock_executable>true</mlock_executable>\n\n    <users>\n        <default>\n	    <password>password</password>\n\n            <networks>\n                <ip>::/0</ip>\n            </networks>\n\n            <profile>default</profile>\n            <quota>default</quota>\n\n            <access_management>1</access_management>\n            <named_collection_control>1</named_collection_control>\n        </default>\n    </users>\n\n    <profiles>\n        <default/>\n    </profiles>\n\n    <quotas>\n        <default/>\n    </quotas>\n</clickhouse>\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"Start ClickHouse with it:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"clickhouse server --config-file=./my-config.xml\n"})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["The file in ",(0,i.jsx)(e.code,{children:"preprocessed_configs/"})," is a ",(0,i.jsx)(e.strong,{children:"cache"})," \u2014 do not edit it. Always change the original XML used by ",(0,i.jsx)(e.code,{children:"--config-file"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:["If you omit ",(0,i.jsx)(e.code,{children:"--config-file"}),", ClickHouse uses ",(0,i.jsx)(e.strong,{children:"embedded defaults"})," with no password required."]}),"\n",(0,i.jsx)(e.li,{children:"If you\u2019re testing, always provide an explicit config path to ensure reproducibility."}),"\n"]})}),"\n",(0,i.jsx)(e.h2,{id:"verify-configuration-works",children:"Verify Configuration Works"}),"\n",(0,i.jsxs)(e.p,{children:["you\u2019ll typically use a Python client like ",(0,i.jsx)(e.a,{href:"https://github.com/ClickHouse/clickhouse-connect",children:(0,i.jsx)(e.code,{children:"clickhouse-connect"})}),"."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"pip install clickhouse-connect\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'import clickhouse_connect\n\n# Example parameters\nhost = "localhost"\nport = 8123\nuser = "default"\npassword = "your_password"  # Empty by default\ndbname = "default"\n\nclient = clickhouse_connect.get_client(\n    host=host,\n    port=port,\n    username=user,\n    password=password,\n    database=dbname\n)\n\n# Run a test query\nresult = client.query("SELECT now()")\nprint(result.result_rows)\n'})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"clickhouse-connect"})," uses HTTP protocol (port ",(0,i.jsx)(e.code,{children:"8123"}),")."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"clickhouse-driver"})," uses the native TCP protocol (port ",(0,i.jsx)(e.code,{children:"9000"}),")."]}),"\n",(0,i.jsxs)(e.li,{children:["By default, ClickHouse does not require a password for the ",(0,i.jsx)(e.code,{children:"default"})," user unless you've changed the config."]}),"\n"]})}),"\n",(0,i.jsx)(e.h2,{id:"bitcoin-schema-design",children:"Bitcoin Schema Design"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE blocks\n(\n  hash String,\n  size UInt64,\n  stripped_size UInt64,\n  weight UInt64,\n  number UInt64,\n  version UInt64,\n  merkle_root String,\n  timestamp DateTime,\n  timestamp_month Date,\n  nonce String,\n  bits String,\n  coinbase_param String,\n  transaction_count UInt64\n)\nENGINE = ReplacingMergeTree()\nPRIMARY KEY (hash)\nPARTITION BY toYYYYMM(timestamp_month)\nORDER BY hash;\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE transactions\n(\n  hash String,\n  size UInt64,\n  virtual_size UInt64,\n  version UInt64,\n  lock_time UInt64,\n  block_hash String,\n  block_number UInt64,\n  block_timestamp DateTime,\n  block_timestamp_month Date,\n  input_count UInt64,\n  output_count UInt64,\n  input_value Float64,\n  output_value Float64,\n  is_coinbase BOOL,\n  fee Float64,\n  inputs Array(Tuple(index UInt64, spent_transaction_hash String, spent_output_index UInt64, script_asm String, script_hex String, sequence UInt64, required_signatures UInt64, type String, addresses Array(String), value Float64)),\n  outputs Array(Tuple(index UInt64, script_asm String, script_hex String, required_signatures UInt64, type String, addresses Array(String), value Float64))\n)\nENGINE = ReplacingMergeTree()\nPRIMARY KEY (block_hash, hash)\nPARTITION BY toYYYYMM(block_timestamp_month)\nORDER BY (block_hash, hash);\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE VIEW outputs AS\nSELECT\n    hash AS transaction_hash,\n    block_hash,\n    block_number,\n    block_timestamp,\n    output.1 AS index,\n    output.2 AS script_asm,\n    output.3 AS script_hex,\n    output.4 AS required_signatures,\n    output.5 AS type,\n    output.6 AS addresses,\n    output.7 AS value\nFROM transactions\nARRAY JOIN outputs AS output;\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE VIEW inputs AS\nSELECT\n    hash AS transaction_hash,\n    block_hash,\n    block_number,\n    block_timestamp,\n    input.1 AS index,\n    input.2 AS spent_transaction_hash,\n    input.3 AS spent_output_index,\n    input.4 AS script_asm,\n    input.5 AS script_hex,\n    input.6 AS sequence,\n    input.7 AS required_signatures,\n    input.8 AS type,\n    input.9 AS addresses,\n    input.10 AS value\nFROM transactions\nARRAY JOIN inputs AS input;\n"})}),"\n",(0,i.jsx)(e.h2,{id:"json-type",children:"JSON type"}),"\n",(0,i.jsx)(e.h3,{id:"blocksjson",children:"blocks.json"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Field"}),(0,i.jsx)(e.th,{children:"Type"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"hash"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"size"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"stripped_size"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"weight"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"number"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"version"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"merkle_root"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"timestamp"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"nonce"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"bits"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"coinbase_param"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"transaction_count"}),(0,i.jsx)(e.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"transactionsjson",children:"transactions.json"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Field"}),(0,i.jsx)(e.th,{children:"Type"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"hash"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"size"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"virtual_size"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"version"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"lock_time"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"block_number"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"block_hash"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"block_timestamp"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"is_coinbase"}),(0,i.jsx)(e.td,{children:"boolean"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"index"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"inputs"}),(0,i.jsx)(e.td,{children:"[]transaction_input"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"outputs"}),(0,i.jsx)(e.td,{children:"[]transaction_output"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"input_count"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"output_count"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"input_value"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"output_value"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"fee"}),(0,i.jsx)(e.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"transaction_input",children:"transaction_input"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Field"}),(0,i.jsx)(e.th,{children:"Type"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"index"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spent_transaction_hash"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spent_output_index"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"script_asm"}),(0,i.jsx)(e.td,{children:"string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"script_hex"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"sequence"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"required_signatures"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"type"}),(0,i.jsx)(e.td,{children:"string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"addresses"}),(0,i.jsx)(e.td,{children:"[]string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"value"}),(0,i.jsx)(e.td,{children:"bigint"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"transaction_output",children:"transaction_output"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Field"}),(0,i.jsx)(e.th,{children:"Type"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"index"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"script_asm"}),(0,i.jsx)(e.td,{children:"string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"script_hex"}),(0,i.jsx)(e.td,{children:"hex_string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"required_signatures"}),(0,i.jsx)(e.td,{children:"bigint"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"type"}),(0,i.jsx)(e.td,{children:"string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"addresses"}),(0,i.jsx)(e.td,{children:"[]string"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"value"}),(0,i.jsx)(e.td,{children:"bigint"})]})]})]})]})}function a(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},80980:function(n,e,t){t.d(e,{Z:()=>d,a:()=>c});var s=t(67294);let i={},r=s.createContext(i);function c(n){let e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);