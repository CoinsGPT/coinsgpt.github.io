<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-3.7.1 docs-doc-page docs-doc-id-bitcoin/kafka-table-engine" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Using the Kafka table engine | CoinsGPT</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://coinsgpt.github.io/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://coinsgpt.github.io/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://coinsgpt.github.io/docs/bitcoin/kafka-table-engine><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_CN><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=3.7.1><meta data-rh=true name=docusaurus_tag content=docs-default-3.7.1><meta data-rh=true name=docsearch:version content=3.7.1><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-3.7.1><meta data-rh=true property=og:title content="Using the Kafka table engine | CoinsGPT"><meta data-rh=true name=description content="Using the Kafka Table Engine"><meta data-rh=true property=og:description content="Using the Kafka Table Engine"><link data-rh=true rel=icon href=/img/docusaurus.ico><link data-rh=true rel=canonical href=https://coinsgpt.github.io/docs/bitcoin/kafka-table-engine><link data-rh=true rel=alternate href=https://coinsgpt.github.io/docs/bitcoin/kafka-table-engine hreflang=en><link data-rh=true rel=alternate href=https://coinsgpt.github.io/zh-CN/docs/bitcoin/kafka-table-engine hreflang=zh-CN><link data-rh=true rel=alternate href=https://coinsgpt.github.io/docs/bitcoin/kafka-table-engine hreflang=x-default><link data-rh=true rel=preconnect href=https://X1Z85QJPUV-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://coinsgpt.github.io/docs/bitcoin/kafka-table-engine","name":"Using the Kafka table engine","position":1}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="CoinsGPT RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="CoinsGPT Atom Feed"><link rel=alternate type=application/json href=/blog/feed.json title="CoinsGPT JSON Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-E5CR2Q1NRE"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E5CR2Q1NRE",{})</script><link rel=search type=application/opensearchdescription+xml title=CoinsGPT href=/opensearch.xml><link rel=alternate type=application/rss+xml href=/changelog/rss.xml title="Docusaurus changelog RSS Feed"><link rel=alternate type=application/atom+xml href=/changelog/atom.xml title="Docusaurus changelog Atom Feed"><link rel=alternate type=application/json href=/changelog/feed.json title="Docusaurus changelog JSON Feed"><link rel=icon href=/img/docusaurus.png><link rel=manifest href=/manifest.json><meta name=theme-color content="rgb(37, 194, 160)"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#000><link rel=apple-touch-icon href=/img/docusaurus.png><link rel=mask-icon href=/img/docusaurus.png color="rgb(62, 204, 94)"><meta name=msapplication-TileImage content=/img/docusaurus.png><meta name=msapplication-TileColor content=#000><link rel=alternate type=application/rss+xml href=/tests/blog/rss.xml title="Docusaurus Tests Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/tests/blog/atom.xml title="Docusaurus Tests Blog Atom Feed"><link rel=alternate type=application/json href=/tests/blog/feed.json title="Docusaurus Tests Blog JSON Feed"><link rel=stylesheet href=/katex/katex.min.css type=text/css><link rel=stylesheet href=/assets/css/styles.cebcf412.css><script src=/assets/js/runtime~main.c57d2944.js defer></script><script src=/assets/js/main.c5a839fe.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme-c24")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss-c24")}catch(t){}return!1}())</script><div id=__docusaurus><link rel=preload as=image href=/img/docusaurus.svg><link rel=preload as=image href=/img/docusaurus_keytar.svg><link rel=preload as=image href=/img/meta_opensource_logo_negative.svg><div role=region aria-label="Skip to main content"><a class=skipToContent_UHvc href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><div class="theme-announcement-bar announcementBar_cTOO" role=banner><div class=announcementBarPlaceholder_Lqfg></div><div class="content_ttnW announcementBarContent_PjqA">üéâÔ∏è <b><a target=_blank href=https://docusaurus.io/blog/releases/3.7>Docusaurus v3.7</a> is out!</b> ü•≥Ô∏è</div><button type=button aria-label=Close class="clean-btn close closeButton_nmpN announcementBarClose_UFLi"><svg viewBox="0 0 15 15" width=14 height=14><g stroke=currentColor stroke-width=3.1><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"/></g></svg></button></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_uAgx"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/docusaurus.svg alt="" class="themedComponent_bJGS themedComponent--light_LEkC" height=32 width=32><img src=/img/docusaurus_keytar.svg alt="" class="themedComponent_bJGS themedComponent--dark_jnGk" height=32 width=32></div><b class="navbar__title text--truncate">CoinsGPT</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/bitcoin/bitcoin-fullnode>Bitcoin</a><a class="navbar__item navbar__link" href=/docs>Docusaurus</a><a class="navbar__item navbar__link" href=/docs/cli>API</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/showcase>Showcase</a><a class="navbar__item navbar__link" href=/community/support>Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs/bitcoin/kafka-table-engine>3.7.1</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/next/bitcoin/kafka-table-engine>Canary üöß</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/bitcoin/kafka-table-engine>3.7.1</a><li><a class=dropdown__link href=/docs/3.7.0>3.7.0</a><li><a class=dropdown__link href=/docs/3.6.3>3.6.3</a><li class=""><hr class=dropdown-separator><li class=dropdown-archived-versions><b>Archived versions</b><li><a href=https://docusaurus-archive-october-2023.netlify.app/docs/2.3.1 target=_blank rel="noopener noreferrer" class=dropdown__link>2.3.1<svg width=12 height=12 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li><a href=https://v1.docusaurus.io target=_blank rel="noopener noreferrer" class=dropdown__link>1.x.x<svg width=12 height=12 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=""><hr class=dropdown-separator><li><a class=dropdown__link href=/versions>All versions</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_tqOs><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/bitcoin/kafka-table-engine target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/zh-CN/docs/bitcoin/kafka-table-engine target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-CN>‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</a><li class=""><hr style="margin: 0.3rem 0;"><li><a href=https://github.com/facebook/docusaurus/issues/3526 target=_blank rel="noopener noreferrer" class=dropdown__link>Help Us Translate<svg width=12 height=12 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a></ul></div><a href=https://github.com/coinsgpt/coinsgpt.github.io target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_nCQi lightToggleIcon_dnYY"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_nCQi darkToggleIcon_OBbf"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_nCQi systemToggleIcon_IWwm"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_dDCC><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_PEsc"><div class=docsWrapper_lLmf><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_PuQw" type=button></button><div class=docRoot_kBZ6><aside class="theme-doc-sidebar-container docSidebarContainer_S51O"><div class=sidebarViewport_K3q9><div class="sidebar_vtcw sidebarWithHideableNavbar_tZ9s"><a tabindex=-1 class=sidebarLogo_UK0N href=/><img src=/img/docusaurus.svg alt="" class="themedComponent_bJGS themedComponent--light_LEkC" height=32 width=32><img src=/img/docusaurus_keytar.svg alt="" class="themedComponent_bJGS themedComponent--dark_jnGk" height=32 width=32><b>CoinsGPT</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_rWGR menuWithAnnouncementBar_Pf08"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/bitcoin/bitcoin-fullnode>Fullnode setup</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/bitcoin/bitcoin-etl>Convert raw data with ETL</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/bitcoin/kafka>Managing Kafka Topics and Consumer Groups</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/docs/bitcoin/kafka-table-engine>Using the Kafka table engine</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/bitcoin/clickhouse-data-verfication>clickhouse-data-verfication</a></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PUyN"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_DI0B><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_EfwR><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_n6xZ"><div class=docItemContainer_RhpI><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Wvrh" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_uaSn><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Using the Kafka table engine</span></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.7.1</span><div class="tocCollapsible_BEWm theme-doc-toc-mobile tocMobile_NSfz"><button type=button class="clean-btn tocCollapsibleButton_IbtT">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kafka to ClickHouse</h1></header>
<div class="language-info codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-info codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">https://clickhouse.com/docs/integrations/kafka/kafka-table-engine</span><br></span></code></pre></div></div>
<p>To use the Kafka table engine, you should be broadly familiar with ClickHouse materialized views.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=overview>Overview<a href=#overview class=hash-link aria-label="Direct link to Overview" title="Direct link to Overview">‚Äã</a></h2>
<p>Initially, we focus on the most common use case: using the Kafka table engine to insert data into ClickHouse from Kafka.</p>
<p>The Kafka table engine allows ClickHouse to read from a Kafka topic directly. Whilst useful for viewing messages on a topic, the engine by design only permits one-time retrieval, i.e. when a query is issued to the table, it consumes data from the queue and increases the consumer offset before returning results to the caller. Data cannot, in effect, be re-read without resetting these offsets.</p>
<p>To persist this data from a read of the table engine, we need a means of capturing the data and inserting it into another table. Trigger-based materialized views natively provide this functionality. A materialized view initiates a read on the table engine, receiving batches of documents. The TO clause determines the destination of the data - typically a table of the Merge Tree family. This process is visualized below:</p>
<p><img decoding=async loading=lazy src=/assets/images/kafka_01-807249e726cadc9d3be21375df967d42.png width=2282 height=1080 class=img_vXGZ></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=1-prepare>1. Prepare<a href=#1-prepare class=hash-link aria-label="Direct link to 1. Prepare" title="Direct link to 1. Prepare">‚Äã</a></h2>
<p>If you have data populated on a target topic, you can adapt the following for use in your dataset. Alternatively, a sample Github dataset is provided <a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/kafka/github_all_columns.ndjson target=_blank rel="noopener noreferrer">here</a>. This dataset is used in the examples below and uses a reduced schema and subset of the rows (specifically, we limit to Github events concerning the <a href=https://github.com/ClickHouse/ClickHouse target=_blank rel="noopener noreferrer">ClickHouse repository</a>), compared to the full dataset available <a href=https://ghe.clickhouse.tech/ target=_blank rel="noopener noreferrer">here</a>, for brevity. This is still sufficient for most of the queries <a href=https://ghe.clickhouse.tech/ target=_blank rel="noopener noreferrer">published with the dataset</a> to work.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=2-configure-clickhouse>2. Optional: Configure ClickHouse<a href=#2-configure-clickhouse class=hash-link aria-label="Direct link to 2. Optional: Configure ClickHouse" title="Direct link to 2. Optional: Configure ClickHouse">‚Äã</a></h2>
<p>This step is required if you are connecting to a secure Kafka. These settings cannot be passed through the SQL DDL commands and must be configured in the ClickHouse config.xml. We assume you are connecting to a SASL secured instance. This is the simplest method when interacting with Confluent Cloud.</p>
<div class="language-xml codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-xml codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>clickhouse</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>kafka</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">       </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>sasl_username</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">username</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>sasl_username</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">       </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>sasl_password</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">password</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>sasl_password</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">       </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>security_protocol</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">sasl_ssl</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>security_protocol</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">       </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>sasl_mechanisms</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">PLAIN</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>sasl_mechanisms</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>kafka</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>clickhouse</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre></div></div>
<p>Either place the above snippet inside a new file under your conf.d/ directory or merge it into existing configuration files.</p>
<p>We're also going to create a database called <code>bitcoin</code> to use in this tutorial:</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>DATABASE</span><span class="token plain"> bitcoin</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Once you've created the database, you'll need to switch over to it:</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>USE</span><span class="token plain"> bitcoin</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=3-create-the-destination-table>3. Create the destination table<a href=#3-create-the-destination-table class=hash-link aria-label="Direct link to 3. Create the destination table" title="Direct link to 3. Create the destination table">‚Äã</a></h2>
<p>Prepare your destination table. In the example below we use the reduced GitHub schema for purposes of brevity. Note that although we use a MergeTree table engine, this example could easily be adapted for any member of the MergeTree family.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  stripped_size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  weight UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  number UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  version UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  merkle_root String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>timestamp</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>DateTime</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  timestamp_month </span><span class="token keyword" style=color:#CF222E>Date</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  nonce String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  bits String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  coinbase_param String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transaction_count UInt64</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ENGINE</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> ReplacingMergeTree</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#CF222E>hash</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>PARTITION</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>BY</span><span class="token plain"> toYYYYMM</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">timestamp_month</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ORDER</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>BY</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>transactions</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  virtual_size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  version UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  lock_time UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_hash String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_number UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_timestamp </span><span class="token keyword" style=color:#CF222E>DateTime</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_timestamp_month </span><span class="token keyword" style=color:#CF222E>Date</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  input_count UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  output_count UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  input_value Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  output_value Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  is_coinbase </span><span class="token keyword" style=color:#CF222E>BOOL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  fee Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  inputs Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Tuple</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#CF222E>index</span><span class="token plain"> UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> spent_transaction_hash String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> spent_output_index UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_asm String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_hex String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> sequence UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> required_signatures UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>type</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> addresses Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">String</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>value</span><span class="token plain"> Float64</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  outputs Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Tuple</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#CF222E>index</span><span class="token plain"> UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_asm String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_hex String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> required_signatures UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>type</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> addresses Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">String</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>value</span><span class="token plain"> Float64</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ENGINE</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> ReplacingMergeTree</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">block_hash</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>PARTITION</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>BY</span><span class="token plain"> toYYYYMM</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">block_timestamp_month</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ORDER</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>BY</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">block_hash</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=4-create-and-populate-the-topic>4. Create and populate the topic<a href=#4-create-and-populate-the-topic class=hash-link aria-label="Direct link to 4. Create and populate the topic" title="Direct link to 4. Create and populate the topic">‚Äã</a></h2>
<p>Next, we're going to create a topic. There are several tools that we can use to do this. If we're running Kafka locally on our machine or inside a Docker container, <a href=https://docs.redpanda.com/current/get-started/rpk-install/ target=_blank rel="noopener noreferrer">RPK</a> works well. We can create a topic called <code>blocks</code> and <code>transactions</code> with 3 partitions by running the following command:</p>
<div class="language-bash codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-bash codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">kafka-topics.sh </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--create</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--topic</span><span class="token plain"> blocks </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --bootstrap-server localhost:9092 </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--partitions</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>3</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --replication-factor </span><span class="token number" style=color:#005CC5>1</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-bash codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">kafka-topics.sh </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--create</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--topic</span><span class="token plain"> transactions </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --bootstrap-server localhost:9092 </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--partitions</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>3</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --replication-factor </span><span class="token number" style=color:#005CC5>1</span><br></span></code></pre></div></div>
<p>Now we need to add these topics to consumer group. We can run a command similar to the following if we're running Kafka locally with authentication disabled:</p>
<p>You do <strong>not</strong> create consumer groups manually. A consumer group is <strong>automatically created</strong> the first time a consumer subscribes to a topic using a new <code>--group</code> (or group.id in code).</p>
<div class="language-bash codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-bash codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">kafka-console-consumer.sh </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --bootstrap-server localhost:9092 </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--topic</span><span class="token plain"> blocks </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--group</span><span class="token plain"> bitcoin-group</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-bash codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">kafka-console-consumer.sh </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  --bootstrap-server localhost:9092 </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--topic</span><span class="token plain"> transactions </span><span class="token punctuation" style=color:#393A34>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token parameter variable" style=color:#E36209>--group</span><span class="token plain"> bitcoin-group</span><br></span></code></pre></div></div>
<p>This creates the <code>bitcoin-group</code> consumer group if it doesn't already exist.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=5-create-the-kafka-table-engine>5. Create the Kafka table engine<a href=#5-create-the-kafka-table-engine class=hash-link aria-label="Direct link to 5. Create the Kafka table engine" title="Direct link to 5. Create the Kafka table engine">‚Äã</a></h2>
<p>The below example creates a table engine with the same schema as the merge tree table. This isn't strictly required, as you can have an alias or ephemeral columns in the target table. The settings are important; however - note the use of <code>JSONEachRow</code> as the data type for consuming JSON from a Kafka topic. The values <code>blocks</code> and <code>bitcoin-group</code> represent the name of the topic and consumer group names, respectively. The topics can actually be a list of values.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks_queue</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  stripped_size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  weight UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  number UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  version UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  merkle_root String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>timestamp</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>DateTime</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  timestamp_month </span><span class="token keyword" style=color:#CF222E>Date</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  nonce String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  bits String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  coinbase_param String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transaction_count UInt64</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ENGINE</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> Kafka</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#C6105F>'localhost:9092'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'blocks'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'bitcoin-group'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'JSONEachRow'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> settings kafka_thread_per_consumer </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> kafka_num_consumers </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>3</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> transactions_queue</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  virtual_size UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  version UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  lock_time UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_hash String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_number UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_timestamp </span><span class="token keyword" style=color:#CF222E>DateTime</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  block_timestamp_month </span><span class="token keyword" style=color:#CF222E>Date</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  input_count UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  output_count UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  input_value Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  output_value Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  is_coinbase </span><span class="token keyword" style=color:#CF222E>BOOL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  fee Float64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  inputs Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Tuple</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#CF222E>index</span><span class="token plain"> UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> spent_transaction_hash String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> spent_output_index UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_asm String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_hex String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> sequence UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> required_signatures UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>type</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> addresses Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">String</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>value</span><span class="token plain"> Float64</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  outputs Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Tuple</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#CF222E>index</span><span class="token plain"> UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_asm String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> script_hex String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> required_signatures UInt64</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>type</span><span class="token plain"> String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> addresses Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">String</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>value</span><span class="token plain"> Float64</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>ENGINE</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> Kafka</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#C6105F>'localhost:9092'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'transactions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'bitcoin-group'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#C6105F>'JSONEachRow'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> settings kafka_thread_per_consumer </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> kafka_num_consumers </span><span class="token operator" style=color:#D73A49>=</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>3</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>We discuss engine settings and performance tuning below. At this point, a simple select on the table <code>blocks_queue</code> should read some rows.  Note that this will move the consumer offsets forward, preventing these rows from being re-read without a <a href=#common-operations>reset</a>. Note the limit and required parameter <code>stream_like_engine_allow_direct_select.</code></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=6-create-the-materialized-view>6. Create the materialized view<a href=#6-create-the-materialized-view class=hash-link aria-label="Direct link to 6. Create the materialized view" title="Direct link to 6. Create the materialized view">‚Äã</a></h2>
<p>The materialized view will connect the two previously created tables, reading data from the Kafka table engine and inserting it into the target merge tree table. We can do a number of data transformations. We will do a simple read and insert. The use of * assumes column names are identical (case sensitive).</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style=color:#CF222E>VIEW</span><span class="token plain"> blocks_mv </span><span class="token keyword" style=color:#CF222E>TO</span><span class="token plain"> blocks </span><span class="token keyword" style=color:#CF222E>AS</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>*</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style=color:#CF222E>VIEW</span><span class="token plain"> transactions_mv </span><span class="token keyword" style=color:#CF222E>TO</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>transactions</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>AS</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>*</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> transactions_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>At the point of creation, the materialized view connects to the Kafka engine and commences reading: inserting rows into the target table. This process will continue indefinitely, with subsequent message inserts into Kafka being consumed. Feel free to re-run the insertion script to insert further messages to Kafka.</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=7-confirm-rows-have-been-inserted>7. Confirm rows have been inserted<a href=#7-confirm-rows-have-been-inserted class=hash-link aria-label="Direct link to 7. Confirm rows have been inserted" title="Direct link to 7. Confirm rows have been inserted">‚Äã</a></h5>
<p>Confirm data exists in the target table:</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token function" style=color:#8250DF>count</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> blocks</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token function" style=color:#8250DF>count</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>transactions</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=common-operations>Common Operations<a href=#common-operations class=hash-link aria-label="Direct link to Common Operations" title="Direct link to Common Operations">‚Äã</a></h4>
<h5 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=stopping--restarting-message-consumption>Stopping & restarting message consumption<a href=#stopping--restarting-message-consumption class=hash-link aria-label="Direct link to Stopping & restarting message consumption" title="Direct link to Stopping & restarting message consumption">‚Äã</a></h5>
<p>To stop message consumption, you can detach the Kafka engine table:</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">DETACH </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>This will not impact the offsets of the consumer group. To restart consumption, and continue from the previous offset, reattach the table.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">ATTACH </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=adding-kafka-metadata>Adding Kafka Metadata<a href=#adding-kafka-metadata class=hash-link aria-label="Direct link to Adding Kafka Metadata" title="Direct link to Adding Kafka Metadata">‚Äã</a></h2>
<p>It can be useful to keep track of the metadata from the original Kafka messages after it's been ingested into ClickHouse. For example, we may want to know how much of a specific topic or partition we have consumed. For this purpose, the Kafka table engine exposes several virtual columns. These can be persisted as columns in our target table by modifying our schema and materialized view's select statement.</p>
<p>First, we perform the stop operation described above before adding columns to our target table.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">DETACH </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Below we add information columns to identify the source topic and the partition from which the row originated.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks</span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token keyword" style=color:#CF222E>ADD</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>COLUMN</span><span class="token plain"> topic String</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token keyword" style=color:#CF222E>ADD</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>COLUMN</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>partition</span><span class="token plain"> UInt64</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Next, we need to ensure virtual columns are mapped as required.
Virtual columns are prefixed with <code>_</code>.
A complete listing of virtual columns can be found <a href=https://clickhouse.com/docs/engines/table-engines/integrations/kafka#virtual-columns target=_blank rel="noopener noreferrer">here</a>.</p>
<p>To update our table with the virtual columns, we'll need to drop the materialized view, re-attach the Kafka engine table, and re-create the materialized view.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>VIEW</span><span class="token plain"> blocks_mv</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token plain">ATTACH </span><span class="token keyword" style=color:#CF222E>TABLE</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style=color:#CF222E>VIEW</span><span class="token plain"> blocks_mv </span><span class="token keyword" style=color:#CF222E>TO</span><span class="token plain"> github </span><span class="token keyword" style=color:#CF222E>AS</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#D73A49>*</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> _topic </span><span class="token keyword" style=color:#CF222E>as</span><span class="token plain"> topic</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> _partition </span><span class="token keyword" style=color:#CF222E>as</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>partition</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> blocks_queue</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Newly consumed rows should have the metadata.</p>
<div class="language-sql codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-sql codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token keyword" style=color:#CF222E>SELECT</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>hash</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> topic</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#CF222E>partition</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>FROM</span><span class="token plain"> blocks</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#CF222E>LIMIT</span><span class="token plain"> </span><span class="token number" style=color:#005CC5>10</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=modify-kafka-engine-settings>Modify Kafka Engine Settings<a href=#modify-kafka-engine-settings class=hash-link aria-label="Direct link to Modify Kafka Engine Settings" title="Direct link to Modify Kafka Engine Settings">‚Äã</a></h2>
<p>We recommend dropping the Kafka engine table and recreating it with the new settings. The materialized view does not need to be modified during this process - message consumption will resume once the Kafka engine table is recreated.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id=debugging-issues>Debugging Issues<a href=#debugging-issues class=hash-link aria-label="Direct link to Debugging Issues" title="Direct link to Debugging Issues">‚Äã</a></h2>
<p>Errors such as authentication issues are not reported in responses to Kafka engine DDL. For diagnosing issues, we recommend using the main ClickHouse log file clickhouse-server.err.log. Further trace logging for the underlying Kafka client library <a href=https://github.com/edenhill/librdkafka target=_blank rel="noopener noreferrer">librdkafka</a> can be enabled through configuration.</p>
<div class="language-xml codeBlockContainer_jDV4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_cKMj><pre tabindex=0 class="prism-code language-xml codeBlock_Gebt thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_FJaf><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>kafka</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#22863A>debug</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">all</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>debug</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#22863A>kafka</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/coinsgpt/coinsgpt.github.io/edit/main/website/docs/bitcoin/kafka-table-engine.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_IMw_ aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_OHCJ"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/bitcoin/kafka><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Managing Kafka Topics and Consumer Groups</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/bitcoin/clickhouse-data-verfication><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>clickhouse-data-verfication</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_RLlU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#overview class="table-of-contents__link toc-highlight">Overview</a><li><a href=#1-prepare class="table-of-contents__link toc-highlight">1. Prepare</a><li><a href=#2-configure-clickhouse class="table-of-contents__link toc-highlight">2. Optional: Configure ClickHouse</a><li><a href=#3-create-the-destination-table class="table-of-contents__link toc-highlight">3. Create the destination table</a><li><a href=#4-create-and-populate-the-topic class="table-of-contents__link toc-highlight">4. Create and populate the topic</a><li><a href=#5-create-the-kafka-table-engine class="table-of-contents__link toc-highlight">5. Create the Kafka table engine</a><li><a href=#6-create-the-materialized-view class="table-of-contents__link toc-highlight">6. Create the materialized view</a><li><a href=#adding-kafka-metadata class="table-of-contents__link toc-highlight">Adding Kafka Metadata</a><li><a href=#modify-kafka-engine-settings class="table-of-contents__link toc-highlight">Modify Kafka Engine Settings</a><li><a href=#debugging-issues class="table-of-contents__link toc-highlight">Debugging Issues</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Learn</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs>Introduction</a><li class=footer__item><a class=footer__link-item href=/docs/installation>Installation</a><li class=footer__item><a class=footer__link-item href=/docs/migration>Migration from v1 to v2</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://stackoverflow.com/questions/tagged/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a class=footer__link-item href=/feature-requests>Feature Requests</a><li class=footer__item><a href=https://discordapp.com/invite/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>Discord<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a class=footer__link-item href=/community/support>Help</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/blog>Blog</a><li class=footer__item><a class=footer__link-item href=/changelog>Changelog</a><li class=footer__item><a href=https://github.com/coinsgpt/coinsgpt.github.io target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://x.com/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>X<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item>
                <a href=https://www.netlify.com target=_blank rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  <img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" width=114 height=51>
                </a>
              <li class=footer__item>
                <a href=https://argos-ci.com target=_blank rel="noreferrer noopener" aria-label="Covered by Argos">
                  <img src=https://argos-ci.com/badge.svg alt="Covered by Argos" width=133 height=20>
                </a>
              </ul></div><div class="theme-layout-footer-column col footer__col footer-column-legal"><div class=footer__title>Legal</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://opensource.facebook.com/legal/privacy/ target=_blank rel="noopener noreferrer" class="footer__link-item footer-item-privacy">Privacy<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/terms/ target=_blank rel="noopener noreferrer" class=footer__link-item>Terms<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/cookie-policy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Cookie Policy<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_Rdzz><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><a href=https://opensource.fb.com rel="noopener noreferrer" class=footerLogoLink_CiM_><img src=/img/meta_opensource_logo_negative.svg alt="Meta Open Source Logo" class="footer__logo themedComponent_bJGS themedComponent--light_LEkC"><img src=/img/meta_opensource_logo_negative.svg alt="Meta Open Source Logo" class="footer__logo themedComponent_bJGS themedComponent--dark_jnGk"></a></div><div class=footer__copyright>Copyright ¬© 2025 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>